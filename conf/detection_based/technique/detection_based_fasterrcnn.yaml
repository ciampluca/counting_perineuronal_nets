# @package _group_
dataset:
    train:
        name: PerineuralNetsDataset
        params:
            root: ${hydra:runtime.cwd}/data/perineuronal_nets
            split: train-specular
            patch_size: 320
            overlap: 0
            random_offset: null  # auto-determined as patch_size / 2
            max_cache_mem: 8_589_934_592  # 8GiB in bytes
            # num_samples: null
            target: detection
            target_params:
                side: 60       # side (in px) of the bounding box localizing a cell
                in_memory: null
                ann_type: null

    validation:
        name: PerineuralNetsDataset
        params:
            root: ${hydra:runtime.cwd}/data/perineuronal_nets
            split: validation-specular
            patch_size: 320
            overlap: 120
            random_offset: 0
            max_cache_mem: 8_589_934_592  # 8GiB in bytes
            # num_samples: null
            target: detection
            target_params:
                side: 60       # side (in px) of the bounding box localizing a cell
                in_memory: null
                ann_type: null


model:
    name: FasterRCNN
    pretrained: null     # path to pretrained weights, optimizer states will not restored
    resume: null    # path to last trained model, will restore optimizer states
    params:
        num_classes: 1
        backbone: resnet50    # resnet50 or resnet101
        backbone_pretrained: true   # on ImageNet
        model_pretrained: true   # on COCO; if true, no need to load the pretrained backbone
        max_dets_per_image: 200
        nms: 0.3
        det_thresh: 0.05
        cache_folder: ${hydra:runtime.cwd}/model_zoo


optimizer:
    name: SGD
    params:
        lr: 0.005
        momentum: 0.9
        weight_decay: 0.0005
    scheduler:
        name: MultiStepLR
        params:
            milestones: [75, 100, 125]
            gamma: 0.1


train:
    batch_size: 8
    val_batch_size: 8
    num_workers: 4
    epochs: 125
    val_freq: 1
    log_every: 20
    debug: true
    debug_freq: 2
    batch_accumulation: 1
    val_device: cpu
    font_size: 100  # for writing over val images
    text_pos: 75
    bb_outline_width: 3


seed: 10
gpu : 0     # index of the gpu you want to use, null for cpu
